<div class="flex flex-col items-center mt-5">
  <div class="overflow-x-auto w-[95vw] mb-5 bg-base-100 rounded-lg shadow-md">
    <table class="table text-center w-full">
      <thead class="rounded-lg">
        <tr class="bg-red-700 text-white rounded-lg">
          <th>Id</th>
          <th>Plan</th>
          <th>Acción dentro del Plan</th>
          <th>Convocatoria</th>
          <th>Detalles</th>
          <th>Usuario</th>
          <th>Fecha Estimada</th>
          <th>Cantidad Solicitada</th>
          <th>Estado</th>
          <th></th>

        </tr>
      </thead>
      <tbody>
        @if(requestsArray() === null) {
          <tr>
            <td colspan="10" class="text-center p-4">
              Cargando solicitudes...
            </td>
          </tr>
        }
        @else if(requestsArray()?.length === 0) {
          <tr>
            <td colspan="10" class="text-center p-4">
              No hay solicitudes de financiación registradas
            </td>
          </tr>
        }
        @else {
          @for(req of requestsArray(); track req.id) {
            <tr class="hover:bg-gray-100 ">
              <td>{{ req.id }}</td>
              <td>{{ req.plan_title }}</td>
              <td>{{ req.action }}</td>
              <td>{{ req.call_for_proposals }}</td>
              <td>{{ req.details_financing || '-' }}</td>
              <td>{{ req.user }}</td>
              <td>{{ req.estimated_date }}</td>
              <td>{{ req.solicited_amount | currency:'EUR' }}</td>
              <td>
                <span
                  class="px-2 py-1 rounded-full text-sm"
                  [ngClass]="{
                    'bg-yellow-200 text-yellow-800': req.status === 'Pendiente',
                    'bg-green-200 text-green-800': req.status === 'Aprobada',
                    'bg-red-200 text-red-800': req.status === 'Rechazada',
                  }"
                >
                  {{ req.status }}
                </span>
              </td>

              <!-- Acciones por rol -->
              <td class="flex flex-row justify-center items-center gap-4 px-5 py-7">
                @if(user()?.role_id==3){
                  <a class="cursor-pointer" (click)="addRequest(req.id)" title="Generar PDF">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path fill="#000" d="M13 9V3.5L18.5 9M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" />
                    </svg>
                  </a>
                  <a class="cursor-pointer" (click)="downloadRequest(req.id)" title="Descargar PDF">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path fill="#000" d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-6 4q-.825 0-1.412-.587T4 18v-3h2v3h12v-3h2v3q0 .825-.587 1.413T18 20z" />
                    </svg>
                  </a>
                }

                @if(user()?.role_id==2){
                  <a (click)="changeStatusRequest(req.id, 'approve')" class="cursor-pointer" title="Aprobar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path fill="#000" d="m23 12l-2.44-2.78l.34-3.68l-3.61-.82l-1.89-3.18L12 3L8.6 1.54L6.71 4.72l-3.61.81l.34 3.68L1 12l2.44 2.78l-.34 3.69l3.61.82l1.89 3.18L12 21l3.4 1.46l1.89-3.18l3.61-.82l-.34-3.68zm-13 5l-4-4l1.41-1.41L10 14.17l6.59-6.59L18 9z" />
                    </svg>
                  </a>
                  <a (click)="changeStatusRequest(req.id, 'decline')" class="cursor-pointer" title="Rechazar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m5 19l7-7m0 0l7-7m-7 7L5 5m7 7l7 7" />
                    </svg>
                  </a>
                }
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
    <div class="text-center text-red-700">
      {{ message() }}
    </div>
  </div>
</div>
